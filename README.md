# Intro

This repository is a description for a tool presented in my work Cuenca-Guardiola, J., de la Morena-Barrio, B., García, J. L., Sanchis-Juan, A., Corral, J., & Fernández-Breis, J. T. (2022). Improvement of large copy number variant detection by whole genome nanopore sequencing. _Journal of advanced research_, S2090-1232(22)00241-7. Advance online publication. https://doi.org/10.1016/j.jare.2022.10.012.

disCoverage is a software tool to refine calling for structural variants using coverage analysis (so it can only check deletions and duplications).

It takes a list of variants in 4-column bed, or just from VCFs with sructural variants, and checks whether the coverage in the region agrees with the SV type. This is useful for filtering out wrong callings from variant callers, and to check whether a certain region carries a DEL/DUP.

If you use disCoverage in your research, please read and cite teh mentioned work: 10.1016/j.jare.2022.10.012.

# Installation

For installing with conda, `[mamba]`(https://github.com/mamba-org/mamba), and `boa` (mambabuild) are recommended (conda and conda-build, which also requires to be installed, are slower):

```
git clone https://github.com/javiercguard/disCoverage
cd disCoverage
mamba mambabuild conda
mamba create --use-local -n discoverage discoverage
mamba activate discoverage
disCoverage -h
```

With conda-build it would be:
```
git clone https://github.com/javiercguard/disCoverage
cd disCoverage
conda conda-build conda
conda create --use-local -n discoverage discoverage
conda activate discoverage
disCoverage -h
```

# Usage

## Basic usage

### Input data

disCoverage needs an alignment file (BAM) to get coverage data (using the great [Mosdepth](https://github.com/brentp/mosdepth) tool).
It also requires a 4-column bed file with the SVs that need to be checked:

```
chr1	123000000	124000000	DEL
chr2	150000000	150500000	DUP
```

However, these BED files can be generated by disCoverage itself from VCF files (.vcf or .vcf.gz). Using large files with thousands of variants will have an impact on run time. Using a subset of SVs is recommended. Also note that disCoverage can only analyze deletions and duplications, so it will ignore other variants.

### Basic command

For a single sample:

```bash
disCoverage -bam <bamFile1>.bam -bed <bedFile1>.bed -o <outputDirectory> -i "analysisLabel" -t <threadNumber>
```

To use VCFs, the command is very simmilar (it still uses the `-bed` option):

```bash
disCoverage -bam <bamFile1>.bam -bed <vcfFile1>.vcf -o <outputDirectory> -i "analysisLabel" -t <threadNumber>
```

Although currently most of running time is consumed by wirting coverage to disk, using 4 or preferibly more threads is recommended.

This will create a series of files: `outputDirectory/P1.analysisLabel.<etc>`

For multiple samples:
```bash
disCoverage -bam <bamFile1>.bam <bamFile2>.bam -bed <bedFile1>.bed <bedFile2>.bed -o <outputDirectory> -i "analysisLabel" -t <threadNumber>
```

This will create `outputDirectory/P1.analysisLabel.<etc>` and `outputDirectory/P2.analysisLabel.<etc>`.

If you wish to change the "P", use the `-p` parameter.

### Second (and subsequent) run(s)

If disCoverage has been run once for a sample, and the coverage files generated by mosdepth still exist, they can be reused, which will make subsequent runs faster:

```bash
disCoverage --skip-mosdepth -o <outputDirectory> -i "secondLabel" -t <threadNumber> \
	-bam <bamFile1>.bam <bamFile2>.bam \
	-bed <bedFile1>.bed <bedFile1>.bed \
	-cov <P1.firstLabel.per-region.bed.gz> <P2.firstLabel.per-region.bed.gz>
```